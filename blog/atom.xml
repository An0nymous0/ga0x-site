<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ga0x.com/blog</id>
    <title>An0nymous Blog</title>
    <updated>2021-11-23T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ga0x.com/blog"/>
    <subtitle>An0nymous Blog</subtitle>
    <icon>https://ga0x.com/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Spring Boot Redis lettuce驱动连接出现 io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.]]></title>
        <id>/2021/11/23/lettuce-error-noauth</id>
        <link href="https://ga0x.com/blog/2021/11/23/lettuce-error-noauth"/>
        <updated>2021-11-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[问题]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_mojV" id="问题">问题<a class="hash-link" href="#问题" title="Direct link to heading">​</a></h2><p>命令行连接明明没有问题，Spring Boot 的YML配置也是对的 但是死活出现密码不对。</p><p>报错日志</p><div class="codeBlockContainer_I0IT language-log theme-code-block"><div class="codeBlockContent_wNvx log"><pre tabindex="0" class="prism-code language-log codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-23 15:04:02.492  WARN 12681 --- [oundedElastic-1] o.s.b.a.r.RedisReactiveHealthIndicator   : Redis health check failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is org.springframework.data.redis.connection.PoolException: Could not get a resource from the pool; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to 172.18.150.9:6379</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.translateException(LettuceConnectionFactory.java:1689)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1597)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1383)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1366)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedReactiveConnection(LettuceConnectionFactory.java:1117)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:509)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:103)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at reactor.core.publisher.MonoSupplier.call(MonoSupplier.java:86)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:227)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.lang.Thread.run(Thread.java:829)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: org.springframework.data.redis.connection.PoolException: Could not get a resource from the pool; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to 172.18.150.9:6379</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettucePoolingConnectionProvider.getConnection(LettucePoolingConnectionProvider.java:109)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1595)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 15 common frames omitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: io.lettuce.core.RedisConnectionException: Unable to connect to 172.18.150.9:6379</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:78)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:56)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.AbstractRedisClient.getConnection(AbstractRedisClient.java:330)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.RedisClient.connect(RedisClient.java:216)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.lambda$getConnection$1(StandaloneConnectionProvider.java:115)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.base/java.util.Optional.orElseGet(Optional.java:369)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.getConnection(StandaloneConnectionProvider.java:115)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettucePoolingConnectionProvider.lambda$null$0(LettucePoolingConnectionProvider.java:97)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.support.ConnectionPoolSupport$RedisPooledObjectFactory.create(ConnectionPoolSupport.java:211)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.support.ConnectionPoolSupport$RedisPooledObjectFactory.create(ConnectionPoolSupport.java:201)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.commons.pool2.BasePooledObjectFactory.makeObject(BasePooledObjectFactory.java:70)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.commons.pool2.impl.GenericObjectPool.create(GenericObjectPool.java:571)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:298)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:223)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.support.ConnectionPoolSupport$1.borrowObject(ConnectionPoolSupport.java:122)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.support.ConnectionPoolSupport$1.borrowObject(ConnectionPoolSupport.java:117)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.springframework.data.redis.connection.lettuce.LettucePoolingConnectionProvider.getConnection(LettucePoolingConnectionProvider.java:103)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 16 common frames omitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: io.lettuce.core.RedisCommandExecutionException: NOAUTH Authentication required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.internal.ExceptionFactory.createExecutionException(ExceptionFactory.java:137)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.internal.ExceptionFactory.createExecutionException(ExceptionFactory.java:110)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.AsyncCommand.completeResult(AsyncCommand.java:120)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.AsyncCommand.complete(AsyncCommand.java:111)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.CommandWrapper.complete(CommandWrapper.java:63)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.CommandHandler.complete(CommandHandler.java:746)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.CommandHandler.decode(CommandHandler.java:681)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.lettuce.core.protocol.CommandHandler.channelRead(CommandHandler.java:598)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 1 common frames omitted</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="具体原因">具体原因<a class="hash-link" href="#具体原因" title="Direct link to heading">​</a></h2><p>问题出在客户端上，某些云厂商魔改的redis导致协议跟官方有出入。所以导致lettuce在判断协议时 并不准确。</p><p>想了解更多的请参考我提的issues<a href="https://github.com/lettuce-io/lettuce-core/issues/1543" target="_blank" rel="noopener noreferrer">1543</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何解决">如何解决<a class="hash-link" href="#如何解决" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="方式一">方式一<a class="hash-link" href="#方式一" title="Direct link to heading">​</a></h3><p>降级lettuce客户端到5.3.x，因为自动识别RESP2/RESP3协议是6.x版本加上去的</p><div class="codeBlockContainer_I0IT language-gradle theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">build.gradle</div><div class="codeBlockContent_wNvx gradle"><pre tabindex="0" class="prism-code language-gradle codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">implementation 'io.lettuce:lettuce-core:5.3.7.RELEASE'</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="方式二">方式二<a class="hash-link" href="#方式二" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WebConfig</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">WebMvcConfigurer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * https://github.com/lettuce-io/lettuce-core/issues/1201</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * https://github.com/lettuce-io/lettuce-core/issues/1543</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">LettuceClientConfigurationBuilderCustomizer</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">redisBuilderCustomizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> builder </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clientOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ClientOptions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">builder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">protocolVersion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ProtocolVersion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RESP2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="Spring Boot" term="Spring Boot"/>
        <category label="lettuce" term="lettuce"/>
        <category label="Java" term="Java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[graalvm 在 macOS Catalina 上提示无法验证开发人员警告问题]]></title>
        <id>/2021/11/03/graalvm-damaged-error</id>
        <link href="https://ga0x.com/blog/2021/11/03/graalvm-damaged-error"/>
        <updated>2021-11-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[img.png]]></summary>
        <content type="html"><![CDATA[<p><img loading="lazy" alt="img.png" src="/assets/images/img-5619a4dc6afa0937df25f4b4a3854300.png" width="260" height="234"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="背景">背景<a class="hash-link" href="#背景" title="Direct link to heading">​</a></h2><p>提示:</p><blockquote><p>“graalvm-ce-java11-20.3.0” is damaged and can’t be opened.</p><p>或</p><p>“graalvm-ce-java11-21.3.0”已损坏，无法打开。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何解决">如何解决<a class="hash-link" href="#如何解决" title="Direct link to heading">​</a></h2><p>在 macOS Catalina 上，您可能会收到“无法验证开发人员”的警告。这是因为 GraalVM 尚未签名和认证。但是，可以在“安全和隐私”首选项窗格中或通过运行以下命令来禁用该检查：</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">xattr -r -d com.apple.quarantine /Library/Java/JavaVirtualMachines/graalvm-ce-javaV-XX.Y.Z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><a href="https://github.com/graalvm/homebrew-tap#macos-catalina-specifics" target="_blank" rel="noopener noreferrer">官方解释和说明</a></p>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="macOS" term="macOS"/>
        <category label="GraalVM" term="GraalVM"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JetBrains全系列软件激活教程]]></title>
        <id>/2021/11/01/jetbrains-crack</id>
        <link href="https://ga0x.com/blog/2021/11/01/jetbrains-crack"/>
        <updated>2021-11-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[img.png]]></summary>
        <content type="html"><![CDATA[<p><img loading="lazy" alt="img.png" src="/assets/images/img-92c658b357bc2abf3b2ea9dfaba6f8da.png" width="1360" height="544"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="通过agent激活码方式1">通过agent+激活码方式1<a class="hash-link" href="#通过agent激活码方式1" title="Direct link to heading">​</a></h2><ol><li><a href="https://www.jetbrains.com/" target="_blank" rel="noopener noreferrer">JetBrains官网</a>&nbsp;下载安装你需要的 IDE，如果下载慢可以在 macwk 搜索 jetbrains。</li><li>下载&nbsp;<a href="https://macwk.lanzouo.com/i8eElxh573a" target="_blank" rel="noopener noreferrer">Jetbrains.zip</a>，下载后解压，得到 fineagent.jar，将该文件复制到&nbsp;<code>/Users/你的用户名/</code>&nbsp;文件夹下</li><li>打开访达，点击左侧的&nbsp;<code>应用程序</code>&nbsp;找到&nbsp;<code>WebStorm</code>，在 WebStorm 图标上右键，点击&nbsp;<code>显示包内容</code></li><li>进入&nbsp;<code>Contents</code>&nbsp;目录，再进入&nbsp;<code>bin</code>&nbsp;目录，使用文本编辑器打开&nbsp;<code>webstorm.vmoptions</code>&nbsp;文件</li><li>在最后面添加&nbsp;<code>-javaagent:/Users/你的用户名/fineagent.jar</code>，记得修改一下你的用户名。</li><li>运行 WebStorm, 选择&nbsp;<code>Activate WebStorm</code>，再点击&nbsp;<code>Activation Code</code></li><li>复制下面的的激活码粘贴到激活窗口的输入框中，点击&nbsp;<code>Activate</code>。可以用到 2099 年！</li></ol><div class="codeBlockContainer_I0IT language-textile theme-code-block"><div class="codeBlockContent_wNvx textile"><pre tabindex="0" class="prism-code language-textile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">5AYV1D1RE5-eyJsaWNlbnNlSWQiOiI1QVlWMUQxUkU1IiwibGljZW5zZWVOYW1lIjoiaHR0cHM6Ly93d3cuaml3ZWljaGVuZ3podS5jb20iLCJhc3NpZ25lZU5hbWUiOiIiLCJhc3NpZ25lZUVtYWlsIjoiIiwibGljZW5zZVJlc3RyaWN0aW9uIjoiIiwiY2hlY2tDb25jdXJyZW50VXNlIjpmYWxzZSwicHJvZHVjdHMiOlt7ImNvZGUiOiJJSSIsImZhbGxiYWNrRGF0ZSI6IjIwOTktMTItMzEiLCJwYWlkVXBUbyI6IjIwOTktMTItMzEifSx7ImNvZGUiOiJBQyIsImZhbGxiYWNrRGF0ZSI6IjIwOTktMTItMzEiLCJwYWlkVXBUbyI6IjIwOTktMTItMzEifSx7ImNvZGUiOiJEUE4iLCJmYWxsYmFja0RhdGUiOiIyMDk5LTEyLTMxIiwicGFpZFVwVG8iOiIyMDk5LTEyLTMxIn0seyJjb2RlIjoiUFMiLCJmYWxsYmFja0RhdGUiOiIyMDk5LTEyLTMxIiwicGFpZFVwVG8iOiIyMDk5LTEyLTMxIn0seyJjb2RlIjoiR08iLCJmYWxsYmFja0RhdGUiOiIyMDk5LTEyLTMxIiwicGFpZFVwVG8iOiIyMDk5LTEyLTMxIn0seyJjb2RlIjoiRE0iLCJmYWxsYmFja0RhdGUiOiIyMDk5LTEyLTMxIiwicGFpZFVwVG8iOiIyMDk5LTEyLTMxIn0seyJjb2RlIjoiQ0wiLCJmYWxsYmFja0RhdGUiOiIyMDk5LTEyLTMxIiwicGFpZFVwVG8iOiIyMDk5LTEyLTMxIn0seyJjb2RlIjoiUlMwIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IlJDIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IlJEIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IlBDIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IlJNIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IldTIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IkRCIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IkRDIiwiZmFsbGJhY2tEYXRlIjoiMjA5OS0xMi0zMSIsInBhaWRVcFRvIjoiMjA5OS0xMi0zMSJ9LHsiY29kZSI6IlJTVSIsImZhbGxiYWNrRGF0ZSI6IjIwOTktMTItMzEiLCJwYWlkVXBUbyI6IjIwOTktMTItMzEifV0sImhhc2giOiIxMjc5Njg3Ny8wIiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-HNPogO0kWkHCVMnsjmBXUqQt87UPHqdkYqZGveSJtu8hb2V2Yq7gHsHenp4UuEd3jwEwC+YrUIf7U5yDA/56F5Sdn0RLUHZX5DHeQbJPbmYCBsDRT7m8rnmMFOSZn3vwNatvv1cooZbcGOk3Wwxx6bF7XcgaIrmXRcmZMZgv2PZehr0WS1HxNKe3X4nbGP3MwiSbg4ypmxNDrljmgv+Si9QDDwNLDffqeO0Lce0FqEJuMWmvBS42S0aeIYF8IS5bp4+LFKLJ8T7tF40OxKYDurBb9+9c43GZBscM/eLB8Jos66jNGFwgebFUlvhzJKVHZtuc/N8zGeEnTq6K0T/B8w==-MIIDTjCCAjagAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMCAXDTE4MTEwMTEyMjk0NloYDzIwOTkwODA5MDIyNjA3WjAfMR0wGwYDVQQDDBRwcm9kMnktZnJvbS0yMDIwMTAxOTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMK3eyr0+Oys/TwcQO+qYaXWGBmXcEP4fR0bHHzZd/4WNGltXhecM80OWthA38BQRYAJBCKz/dSkO2Kj1H2y+7KB5cIaOiJEyTESfTSgzQdot6laRBU8oxy9mmagI46M8zEEmplPybY4YJj4HOwZiBsMQEMxoTgMDLpuHX6uASoVhSj6koB55lOj4wEgsQBeAMWTAXmTl88ixE179J8aBUkBGpL8w/tZzl9BJXZNF15gPfkS58rw8cdPzXLS0Yym37A2/KKFhfHzJc5KhbaxqYzmkAfTMqPsIqCQ1lQUAqfiPn2gN2I1Z3/cQuEW27M55fXVr2DduQe5DWzYJs85L50CAwEAAaOBmTCBljAJBgNVHRMEAjAAMB0GA1UdDgQWBBQk2hEilvWFQcCTR+gxI0z0wIQC/zBIBgNVHSMEQTA/gBSjnrZIZ0ISNkG9beC5tKBSi5fxs6EcpBowGDEWMBQGA1UEAwwNSmV0UHJvZmlsZSBDQYIJANJssYOyg3nhMBMGA1UdJQQMMAoGCCsGAQUFBwMBMAsGA1UdDwQEAwIFoDANBgkqhkiG9w0BAQsFAAOCAQEAsCQBjO5wttco/Z5cj/o4GBrku8UtBBBVFq4xsBanshTHm4deVxcTvta4aScV0TPKcaLqGqWx8A9v8XXO8dBbCuyXvWZteZ/C2Covg1xXiM99lz7VxqpjVmLdKanZn5u0gQSiYJdcfF+TdbmEIeSOnN/kLXNq2hXdJQK2zk2J25UZqu5EibRtTbdOzw6ZcfwJ8uOntXfsmAhnNICP3Wf/4wR/mwB0Ka4S+JA3IbF5MUmUZ/fjUaFarnin70us+Vxf/sZUi7u67wilvwVV0NAqDpthHUV0NRc4q+yOr2Dt/uCHdy4XRXLJfAv/z9/xBwNZZALNz3EtQL6IeIWWJByl3g==</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="通过agent激活码方式2推荐">通过agent+激活码方式2（推荐）<a class="hash-link" href="#通过agent激活码方式2推荐" title="Direct link to heading">​</a></h2><p><a href="https://jetbra.in/s?source=https://ga0x.com" target="_blank" rel="noopener noreferrer">点我传送</a></p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="无限重置试用">无限重置试用<a class="hash-link" href="#无限重置试用" title="Direct link to heading">​</a></h2><blockquote><p>此方法 Windows MacOS 通用</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="背景">背景<a class="hash-link" href="#背景" title="Direct link to heading">​</a></h2><p>Jetbrains 家的产品有一个很良心的地方，他会允许你试用 30 天（这个数字写死在代码里了）以评估是否你真的需要为它而付费。 但很多时候会出现一种情况：IDE 并不能按照我们实际的试用时间来计算。</p><p>我举个例子：如果我们开始了试用，然后媳妇生孩子要你回去陪产！陪产时我们并无空闲对IDE试用评估，它依旧算试用时间。（只是举个例子，或许你并没有女朋友）</p><p>发现了吗？你未能真的有 30 天来对它进行全面的试用评估，你甚至无法作出是否付费的决定。此时你会想要延长试用时间，然而 Jetbrains 并未提供相关功能，该怎么办？</p><p>事实上有一款插件可以实现这个功能，你或许可以用它来重置一下试用时间。但切记不要无休止的一直试用，这并不是这个插件的初衷!</p><p><img loading="lazy" alt="1.png" src="/assets/images/1-4b70ab1f49de9da505af218b91d93a33.png" width="1000" height="633"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何安装">如何安装<a class="hash-link" href="#如何安装" title="Direct link to heading">​</a></h2><blockquote><p>提供以下两种方法，二选一即可。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="插件市场安装">插件市场安装<a class="hash-link" href="#插件市场安装" title="Direct link to heading">​</a></h3><p>在 Settings/Preferences... -&gt; Plugins 内手动添加第三方插件仓库地址：<a href="https://plugins.zhile.io" target="_blank" rel="noopener noreferrer">https://plugins.zhile.io</a> 搜索：IDE Eval Reset 插件进行安装。</p><p><img loading="lazy" alt="2.png" src="/assets/images/2-6e4b360f19ba8c720ab2a51efcfbc146.png" width="1000" height="724">
<img loading="lazy" alt="3.png" src="/assets/images/3-da30d903c8c5821ef402c2f4fd2eeaf6.png" width="1000" height="746">
<img loading="lazy" alt="4.png" src="/assets/images/4-f8f509d2d7b54d1571dc004879b48241.png" width="1000" height="417">
<img loading="lazy" alt="5.png" src="/assets/images/5-059d00e30a0a8d87af9877192902c90e.png" width="1000" height="402">
<img loading="lazy" alt="6.png" src="/assets/images/6-bdafcf7b271aefea5e053728e225aecf.png" width="1000" height="744">
<img loading="lazy" alt="7.png" src="/assets/images/7-fc8b877fa34131dc5cb48f2333cf0620.png" width="652" height="760">
<img loading="lazy" alt="8.png" src="/assets/images/8-fda26a68c14a9cbe44ef23833f30a48e.png" width="1000" height="740"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="手动下载安装">手动下载安装<a class="hash-link" href="#手动下载安装" title="Direct link to heading">​</a></h3><p>点击<a href="https://www.lanzouw.com/iL6QXw03iqj" target="_blank" rel="noopener noreferrer">这个链接(v2.3.5)</a>下载插件的 zip 包（macOS可能会自动解压，切记使用的是 zip 包，不是解压后的文件夹！），然后打开 Settings/Preferences... -&gt; Plugins 手动安装插件。
<img loading="lazy" alt="9.png" src="/assets/images/9-99c91270a939035bb493c0fc19e49dde.png" width="1000" height="745">
<img loading="lazy" alt="10.png" src="/assets/images/10-2cdffd6ec779d5ff688eeb0d3cca0a94.png" width="1000" height="745">
<img loading="lazy" alt="11.png" src="/assets/images/11-000534e293c75c72e443e07dd4869d8e.png" width="1000" height="749">
<img loading="lazy" alt="12.png" src="/assets/images/12-82e3aa2f6b83246807725983f721ef35.png" width="1000" height="745"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何使用">如何使用<a class="hash-link" href="#如何使用" title="Direct link to heading">​</a></h2><p>一般来说，在 IDE 窗口切出去或切回来时（窗口失去/得到焦点）会触发事件，检测是否长时间（25天）没有重置，给通知让你选择。（初次安装因为无法获取上次重置时间，会直接给予提示）。</p><p>您也可以手动唤出插件的主界面：</p><p>a. 如果 IDE 没有打开项目，在 Welcome 界面点击 IDE 的菜单：Get Help -&gt; Eval Reset</p><p>b. 如果 IDE 打开了项目，点击 IDE 的菜单：Help -&gt; Eval Reset</p><p>唤出的插件主界面中包含了一些显示信息，有 2 个按钮和 1 个勾选项：</p><ul><li>按钮：Reload 用来刷新界面上的显示信息。</li><li>按钮：Reset 点击会询问是否重置试用信息并重启 IDE。选择 Yes 则执行重置操作并重启 IDE 生效，选择 No 则什么也不做。（此为手动重置方式）</li><li>勾选项：Auto reset before per restart 如果勾选了，则自勾选后每次重启/退出 IDE 时会自动重置试用信息，你无需做额外的事情。（此为自动重置方式，推荐此方法！）</li></ul><p><img loading="lazy" alt="13.png" src="/assets/images/13-eb41228014447f216e3cc24c149b23f8.png" width="1000" height="872">
<img loading="lazy" alt="14.png" src="/assets/images/14-a449157d9aa709fb53fd0ca96aad3764.png" width="1000" height="795">
<img loading="lazy" alt="15.png" src="/assets/images/15-4309cb9bd8249d06e96e2a720a3b61e1.png" width="1000" height="796"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何更新">如何更新<a class="hash-link" href="#如何更新" title="Direct link to heading">​</a></h2><ol><li>插件更新机制（推荐）：</li></ol><p>IDE 会自行检测其自身和所安装插件的更新并给予提示。如果本插件有更新，你会收到提示看到更新日志，自行选择是否更新。</p><p>点击 IDE 的 Check for Updates... 菜单手动检测 IDE 和所安装插件的更新。如果本插件有更新，你会收到提示看到更新日志，自行选择是否更新。</p><p>插件更新可能会需要重启IDE。</p><ol start="2"><li>手动更新：</li></ol><p>从本页面下载最新的插件 zip 包安装更新。插件更新需要重启IDE。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="一些说明">一些说明<a class="hash-link" href="#一些说明" title="Direct link to heading">​</a></h2><p>市场付费插件的试用信息也会一并重置。</p><p>MyBatisCodeHelperPro 插件有两个版本如下，功能完全相同，安装时须看清楚！</p><ul><li><a href="https://plugins.jetbrains.com/plugin/14522-mybatiscodehelperpro-marketplace-edition-" target="_blank" rel="noopener noreferrer">MyBatisCodeHelperPro</a> (Marketplace Edition)，可重置！</li><li><a href="https://plugins.jetbrains.com/plugin/9837-mybatiscodehelperpro" target="_blank" rel="noopener noreferrer">MyBatisCodeHelperPro</a>，不可重置！</li></ul><p>对于某些付费插件（如: Iedis 2, MinBatis）来说，你可能需要去取掉 javaagent 配置（如果有）后重启IDE：</p><ul><li>如果IDE没有打开项目，在 Welcome 界面点击菜单：Configure -&gt; Edit Custom VM Options... -&gt; 移除 -javaagent: 开头的行。</li><li>如果IDE打开了项目，点击菜单：Help -&gt; Edit Custom VM Options... -&gt; 移除 -javaagent: 开头的行。</li></ul><p>重置需要重启IDE生效！</p><p>重置后并不弹出 Licenses 对话框让你选择输入 License 或试用，这和之前的重置脚本/插件不同（省去这烦人的一步）。</p><p>如果长达 25 天不曾有任何重置动作，IDE 会有通知询问你是否进行重置。</p><p>如果勾选：Auto reset before per restart ，重置是静默无感知的。</p><p>简单来说：勾选了 Auto reset before per restart 则无需再管，一劳永逸。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="中文汉化包">中文汉化包<a class="hash-link" href="#中文汉化包" title="Direct link to heading">​</a></h2><p>JetBrains 系列大部分在<strong>官方</strong>的插件中心直接安装使用了。</p><p>以 WebStrom 为例，打开它的设置，点击 Plugins，搜索 chinese，安装即可。</p><p><img loading="lazy" alt="16.png" src="/assets/images/16-754cc2cf3788ef148c9ea31d72247afa.png" width="1500" height="994"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="支持的产品">支持的产品<a class="hash-link" href="#支持的产品" title="Direct link to heading">​</a></h2><ul><li>IntelliJ IDEA</li><li>AppCode</li><li>CLion</li><li>DataGrip</li><li>GoLand</li><li>PhpStorm</li><li>PyCharm</li><li>Rider</li><li>RubyMine</li><li>WebStorm</li></ul>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="JetBrains" term="JetBrains"/>
        <category label="IDE" term="IDE"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[优秀的 REST API 设计指南]]></title>
        <id>/2020/07/31/rest-api-design</id>
        <link href="https://ga0x.com/blog/2020/07/31/rest-api-design"/>
        <updated>2020-07-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[本文建议读者：]]></summary>
        <content type="html"><![CDATA[<p>本文建议读者：</p><ul><li>后端工程师、架构师</li><li>需要跟后端协同的前端工程师</li><li>以API提供服务的软件提供商</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><hr><p>作为一名优秀的后端程序员，你照着产品需求设计好了模型，设计好了关联关系。</p><p>把这些模型和关系一再打磨了一番之后，你想是时候把API设计出来，与前端沟通了。</p><p>这时候问题来了：</p><p>一旦 API 进入前端 APP 代码，或者是被你的顾客广泛使用的话，再来大改就非常麻烦了。比如说，如果 APP 版本 1.0 用了一个接口 A，这个接口 A 如果要进行大改，那么必须将 A 维持至所有用户升级过 APP 1.0 后。</p><p>那么怎么样避免 API 发布之后大改呢？有没有一些提前可以注意到的设计准则可以帮我们避开 API 设计中的各种坑？</p><p>答案是有的。网上充满了各种对 API 设计的建议，而这篇文章里我们结合卡拉搜索设计 API 的经验，把 REST API 的最佳实践和常见的坑都总结出来，做成一个教程，希望可以在帮到正在设计/使用 API 的你。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="rest-api-是什么---程序员与服务之间沟通的语言">REST API 是什么 - 程序员与服务之间沟通的语言<a class="hash-link" href="#rest-api-是什么---程序员与服务之间沟通的语言" title="Direct link to heading">​</a></h2><hr><p>任何语言的本质都是一套规则的合集。比如说，中文里要求句子要有主谓宾，而作为母语为中文的我们，一旦有人说了一句缺少主语的话，我们会直觉性地感觉很奇怪。</p><p>比如说，如果有人对你说“是一个神人”。</p><p>你会直觉地问：究竟谁是一个神人？</p><p>同样的，在各个程序的沟通中，或者各个服务的沟通中，我们也需要类似“语言”的东西，让我们可以不需要太多的上下文，就可以前端理解后端、后端也理解前端。</p><p>设想一下，有多少次你跟前端一起需要前后端 <code>联调</code>？有多少次前端觉得你定义的 API 不够方便直观，一定要你多返回一个参数或者改一下端点路径？</p><p>其实本质上，你们在 <code>联调</code> 时就是在尝试设计一个“语言”，以方便互相可以更容易地理解对方。</p><p>比如说，后端会要求前端说，你调用 <code>POST /user/abc</code> 就可以创建一个名为 <code>abc</code> 用户了。</p><p>短线来讲这当然没问题，你们可以几乎任意地定义 API 端点，任意地调整传递的参数。但是一旦项目开始变复杂，问题就开始出现了。</p><ul><li>首先大家有不同的经验和喜好，对 API 的定义可能千差万别，所谓众口难调</li><li>系统开始复杂后，各个系统之间的 API 因为定义的人的不同，会开始出现不一致，导致每个端口调用前需要详细阅读文档（如果有的话）或者与 API 设计者无穷无尽地讨论和会议</li><li>如果你的 API 是面向客户的，比如如果你是一家软件服务公司，那么你自定义的 API 会增加客户接入的成本</li><li>等等等等</li></ul><p>因此，要是有一套人类通用的"语言“或者”规范“，来指导大家定义 API 的方式，那样该多好？</p><p>REST API 就是这样一种规范，它是目前整个互联网应用最广泛的 API 规范。有意思的是，REST是由它的提出者 Roy Fielding 在他读书期间，写的博士论文里提出的。</p><p>总结一下，REST API 有一套 API 设计的准则，它规范了 API 设计的框架，使得服务间、程序员之间有一个通用的沟通语言。如果需要读 API 更广泛的定义，请参考文章<a href="https://kalasearch.cn/blog/what-is-api" target="_blank" rel="noopener noreferrer">什么是 API</a></p><p>REST API是沟通语言</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="rest-api-内具体规定了什么">REST API 内具体规定了什么<a class="hash-link" href="#rest-api-内具体规定了什么" title="Direct link to heading">​</a></h2><hr><p>REST API 规范了 API 设计的两大核心原则</p><ol><li>API应该作用于 Resource（资源）上</li><li>对资源的操作应使用对应语义的几种操作，包括： GET, POST, PUT, PATCH, DELETE</li></ol><p>我们来详细解释一下这两点</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="什么是-rest-api-里的-resource即资源">什么是 REST API 里的 Resource（即资源）<a class="hash-link" href="#什么是-rest-api-里的-resource即资源" title="Direct link to heading">​</a></h3><p>这里的资源是指你的 API 用户可操作的逻辑对象，举个例子</p><p>如果你的 API 中允许调用者对用户进行操作，比如说用户注册，那么 API 类似于</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST /users</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在这里，资源即为 <code>users</code>。在很多情况下，API 中的资源与你的数据模型（也就是数据库的表）是一一对应的。当然也有例外情况，比如说你的数据库中存有用户，但是你现在想要让调用者可以创建“管理员”，那么 API 可能是</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST /admins</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>然而，你的表中并没有 <code>admins</code> 这个表，而是否是 admin 是 Users 表中的一个属性，比如 <code>role=admin</code>。</p><p>请注意，REST API中的资源一定需要是名词，即一定是一个实在存在的概念比如 <code>用户</code>, <code>帐号</code>, <code>车票</code>等，或一个抽象的概念比如 <code>权限</code> 等。如果你需要提供一个创建某种资源的API接口，上述则可以表述为</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST /indexes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /accounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /docs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>等等。</p><p>通常对于资源的命名，我们建议统一命名为为英文的复数。比如说 <code>users</code> 而不是 <code>user</code>。同时请注意保持一致性，在所有地方用一样的复数。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="什么是-rest-api-里的操作">什么是 REST API 里的操作<a class="hash-link" href="#什么是-rest-api-里的操作" title="Direct link to heading">​</a></h3><p>一旦你定义了资源，接下来你需要定义允许调用者在这些资源上做什么操作。</p><p>比如说，以携程抢车票网站为例，我们可能允许调用者进行以下操作</p><ul><li><code>GET /tickets</code> - 列出所有车票</li><li><code>GET /tickets/9839</code> - 列出 id 为 9839 这张车票的信息</li><li><code>POST /tickets</code> - 创建一张车票</li><li><code>PUT /tickets/9839</code> - 更新 9839 这张车票的信息</li><li><code>PATCH /tickets/9839</code> - 部分修改 983 这张车票的信息，比如只修改车票价格</li><li><code>DELETE /tickets/9839</code> - 删掉 9839 这张车票</li></ul><p>请注意，到这里为止，你应该可以总结出来REST的大致设计思路了。它由两部分组成，第一部分是 <code>操作</code>，第二部分是可操作的 <code>资源</code>。比如上文中的 <code>GET /tickets</code>，操作是 GET，可操作的资源是车票。</p><p>那么读到这里，如果你严格遵循了REST的设计准则，以及你的调用者也了解 REST 的准则的话，那么对于很多 API 调用，你们不用再参考互相写的文档了。如果需要调用一张车票的信息，你的调用者自然会知道应该用GET去查看一个车票资源的信息，即 <code>GET /tickets/:ticketId</code>。这样就极大降低了沟通成本和出错成本，提升效率。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="如何在-api-中表示实体数据库表间关系">如何在 API 中表示实体（数据库表）间关系<a class="hash-link" href="#如何在-api-中表示实体数据库表间关系" title="Direct link to heading">​</a></h3><p>在后端设计中，有的资源逻辑上无法独立存在。比如说，在卡拉搜索的例子里，用户的文档是无法独立于索引存在的。那么自然地，我们用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GET /indexes/index_abc/docs/1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>来表达获取索引 <code>index_abc</code> 中编号为 <code>1</code> 的文档。因此，对于所有资源需要依赖于另一个资源存在时，我们就按顺序在端点中将资源列出来。对于卡拉搜索中，索引和文档的关系，我们有以下接口</p><ul><li><code>GET /indexes/index_abc/docs/1</code> - 获取index id为 <code>index_abc</code> 下的id为 <code>1</code> 的文档</li><li><code>GET /indexes/index_abc/docs</code> - 获取index id为 <code>index_abc</code> 下的所有文档</li><li><code>POST /indexes/index_abc/docs</code> - 在index id为 <code>index_abc</code> 的索引中，添加文档 ...</li></ul><p>如果一个资源可以独立于另一个资源存在，并且你期望你的API调用者频繁调用，那么可以考虑直接提供子端点。比如说，如果一个宠物店主人和宠物信息分别都常常被同时调用，那么你可以考虑</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx text"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GET /owners/  - 获取所有主人信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET /owners/1/pets/ 获取 id 为 1 的主人的所有宠物</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET /pets/ - 获取所有宠物信息（宠物店所有宠物）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET /pets/13 - 直接获取 id 为 13 的宠物</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="rest-api中如何表示一个动作">REST API中如何表示一个动作<a class="hash-link" href="#rest-api中如何表示一个动作" title="Direct link to heading">​</a></h3><p>有时候，当我们试图表达一些接口时，会发现REST的准则很难直接应用。比如说，当你需要一个接口让用户登录时</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST /users/signin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>但要注意，这里的 <code>signin</code> 即登录，是一个动词。这里是采用REST准则时需要考虑的地方，你有三个选择</p><ol><li>如果你希望严格地遵循 REST 原则，那么你需要找一个替代动词的名词。比如说，这里的 <code>signin</code> 可以替换为<code>login</code>。或者，如果你是以 token 密钥的方式登录的话，也许可以改为 <code>POST /users/token</code>，即创建一个 user token(也就是登录了)</li><li>在某些实在困难的地方，放弃严格的REST原则</li><li>参考一些成功的 REST API 并寻找类似的 API，参考他们的命名设计</li></ol><p>对于3，我强烈建议你参考 github 的 API，原因不光是其极为规范，还有它覆盖了极多的 API 调用的情景，因此大概率你可以找到个类似的命名参考。</p><p>比如说，在 github 上，如果让你来设计加星这个操作，你会把端点被设计成什么样？</p><p>Github把加星端点设计为 <code>PUT /gists/:id/star</code>，把取消加星设计为 <code>DELETE /gitsts/:id/star</code>。这样就完美地遵循了 REST 名词作为资源的准则，把动词"加星“完美地用 <code>PUT/DELETE</code> 两个操作，清晰地表达了出来。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="rest-api-设计常见问题和建议">REST API 设计常见问题和建议<a class="hash-link" href="#rest-api-设计常见问题和建议" title="Direct link to heading">​</a></h2><hr><p>上面我们描述了 REST 设计的准则，而在准则中并不包括其它”最佳实践“。</p><p>这里的最佳实践，其实并没有什么客观标准，只是软件工程和架构经过多年的发展，REST API 的设计也从十几年前简单的web 应用，到应用到现在越来越复杂企业级软件中。因此，如果你刚刚开始学习 REST API 的设计，参考这些实践经验将会有非常大的帮助，可以帮你少走不少绕路。</p><p><a target="_blank" href="/assets/files/1-dd80166624b4ba531878842200a0d4b9.png"><img loading="lazy" alt="REST API 最佳实践" src="/assets/images/1-dd80166624b4ba531878842200a0d4b9.png" width="700" height="368"></a>REST API 最佳实践</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rest-api-如何区分版本">REST API 如何区分版本<a class="hash-link" href="#rest-api-如何区分版本" title="Direct link to heading">​</a></h3><p>在设计 REST API 时，你应该时刻准备好不断更新 API。想要把 API稳定后再一次发布多数情况下是不实际的——老板要催进度，用户要催功能。因此，在设计 API 的时候就应该把支持 API 改动设计到API本身中。</p><p>多数情况下，在一版 API 已经成熟的前提下，可以提前发布，同时开始进行下一版的开发。而你只需要在URL中区分好 API 的版本即可。</p><p>比如说，如果在大致将 v1 开发完毕后，v1 前缀的 API 就应该稳定下来，所有的改动进入 v2。同时你应该开始通知所有使用 v1 的用户，给他们几周到几个月的时间，帮助他们平滑迁移到 v2</p><p>带有版本前缀的 API 示例如下</p><div class="codeBlockContainer_I0IT language-curl theme-code-block"><div class="codeBlockContent_wNvx curl"><pre tabindex="0" class="prism-code language-curl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GET /v1/indexes/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET /v1/indexes/abc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /v1/indexes/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="rest-api-应该返回什么">REST API 应该返回什么<a class="hash-link" href="#rest-api-应该返回什么" title="Direct link to heading">​</a></h3><p>作为一个通则，我们建议 REST API 永远返回 JSON 格式的结果。</p><p>原因有几个：</p><p>首先，JSON 作为互联网上使用最广泛的格式，在几乎任何语言的任何框架中都有广泛的支持。</p><p>同时，由于其高度的可读性，如果需要阅读返回内容，JSON 会让你的调用者阅读起来方便很多。</p><p>最后，JSON 的高压缩率可以在需要时方便地帮你提升传输效率和速度。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="为什么要给你的-api-编写文档">为什么要给你的 API 编写文档<a class="hash-link" href="#为什么要给你的-api-编写文档" title="Direct link to heading">​</a></h3><p>写代码时，遇到稍复杂的逻辑，我们会发现如果没有注释，一个月后回来发现自己当时写的代码根本不像自己亲生的。再试图熟悉时，可能几个小时就过去了。</p><p>同样，对于 API 来说，如果你不写文档，那么在集成时，你的调用者肯定一边骂，一边尝试各种参数组合。为了让你的调用者有更顺滑的接入体验，每个 API 的设计者都应该把 API 文档作为与 API 的代码一样重要的模块。</p><p>好的 API 文档不光可以方便调用者的接入，更可以方便让你把 API 更改等信息传递出去，而不是一个一个单独通知你的用户。同时在编写文档时，你也会尝试着以你描述地方式接入，间接做了一次"dog food"自测。</p><p>如果你是面向开发者的 API 的话，优秀的 API 文档还可以作为强大的品牌宣传。在卡拉搜索我们花大力气维护我们的文档，同时我们也参考和致敬其它我们用过或者觉得值得夸奖的 API 文档：</p><ul><li><a href="https://kalasearch.cn/docs" target="_blank" rel="noopener noreferrer">卡拉搜索 API 文档 - 用 API 实现搜索引擎</a></li><li><a href="https://leancloud.cn/docs/rest_api.html" target="_blank" rel="noopener noreferrer">Leancloud API文档</a></li><li><a href="https://developer.github.com/v3/" target="_blank" rel="noopener noreferrer">Github API 文档</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="默认开启-gzip-和-pretty-print">默认开启 Gzip 和 Pretty print<a class="hash-link" href="#默认开启-gzip-和-pretty-print" title="Direct link to heading">​</a></h3><p>在返回你的 REST API 结果时，我们建议打开 Gzip 和 Pretty print 两个选项。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="打开-gzip">打开 Gzip<a class="hash-link" href="#打开-gzip" title="Direct link to heading">​</a></h4><p>Gzip 非常好理解，在目前的普通手机算力已经接近十几年前的顶配计算机的前提下，CPU 不再是运算的瓶颈。而网络带宽的扩宽速度则远没有追上 CPU 变快的速度。因此，如果有可能的话，用 CPU 的时间换取网络的传输时间是非常值得的。这也就是说，打开默认 Gzip 压缩，会让你的 JSON 结果耗费少量的服务器 CPU，但却能大大加快传输速度。</p><p>因此我们建议默认将 Gzip 打开。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="打开-pretty-print">打开 Pretty Print<a class="hash-link" href="#打开-pretty-print" title="Direct link to heading">​</a></h4><p>什么是 Pretty print 呢？简单说就是在 JSON 中插入空格和换行，让 JSON 变得美观，方便人阅读。比如下面不是Pretty print:</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx text"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{"name":"大话西游","actor":"周星驰”}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>而下面是打开 Pretty print 后的同一个 JSON</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx text"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name": "大话西游",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "actor": "周星驰”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在 JSON 稍变得复杂之后，如果没有 Pretty print 的 JSON 将会变得完全不可读。虽然打开 Pretty print 会增加一些空白字符，但是由于打开 Gzip 压缩，这些空白字符所占用的空间都会被压缩掉，所以并不用担心网络传输时，JSON 变得更大更慢。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>API是程序员与程序员沟通的语言，一个优秀的API不光可以让你维护起来更轻松，也会让你的调用者在使用时更得心应手。遵循 REST 准则设计出来的优秀的 API，可以减少你与调用者之间的沟通成本，让你可以用更多的时间专注在其它更重要的事情上。</p>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="REST API" term="REST API"/>
        <category label="设计" term="设计"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[CentOS 7 下 yum 安装和配置 NFS]]></title>
        <id>/2020/07/28/centos7-install-nfs</id>
        <link href="https://ga0x.com/blog/2020/07/28/centos7-install-nfs"/>
        <updated>2020-07-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[前言]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_mojV" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p><strong>NFS 是 Network File System 的缩写，即网络文件系统。功能是让客户端通过网络访问不同主机上磁盘里的数据，主要用在类Unix系统上实现文件共享的一种方法。 本例演示 CentOS 7 下安装和配置 NFS 的基本步骤。</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="服务端">服务端<a class="hash-link" href="#服务端" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nfs-utils</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="配置开机启动和启动服务">配置开机启动和启动服务<a class="hash-link" href="#配置开机启动和启动服务" title="Direct link to heading">​</a></h3><p>设置 NFS 开机启动</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> rpcbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> nfs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>启动 NFS 服务</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start rpcbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start nfs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="配置共享目录">配置共享目录<a class="hash-link" href="#配置共享目录" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> /data</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>配置配件</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/exports</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>添加如下配置</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/data/     </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.0/24</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,sync,no_root_squash,no_all_squash</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol><li><code>/data</code>: 共享目录位置。</li><li><code>192.168.0.0/24</code>: 客户端 IP 范围，<code>*</code> 代表所有，即没有限制。</li><li><code>rw</code>: 权限设置，可读可写。</li><li><code>sync</code>: 同步共享目录。</li><li><code>no_root_squash</code>: 可以使用 root 授权。</li><li><code>no_all_squash</code>: 可以使用普通用户授权。</li></ol><p>重启 NFS 服务</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart nfs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>检查配置的共享目录是否正确</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ showmount -e localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export list </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> localhost:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/data </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.0/24</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>服务端配置完毕，接下来配置客户端。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="客户端">客户端<a class="hash-link" href="#客户端" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="安装-nfs">安装 NFS<a class="hash-link" href="#安装-nfs" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nfs-utils</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="配置">配置<a class="hash-link" href="#配置" title="Direct link to heading">​</a></h4><p>设置 rpcbind 开机启动</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> rpcbind</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>启动服务</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start rpcbind</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="客户端连接nfs">客户端连接NFS<a class="hash-link" href="#客户端连接nfs" title="Direct link to heading">​</a></h4><p>查看服务端的共享目录</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ showmount -e </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Export list </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.110:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/data </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.0/24</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在客户端创建目录</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /data</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>挂载远程目录</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> -t nfs </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.101:/data /data</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>mount</code>命令查看一下挂载情况</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.110:/data on /data </span><span class="token builtin class-name">type</span><span class="token plain"> nfs4 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,relatime,sync,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4.1</span><span class="token plain">,rsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">131072</span><span class="token plain">,wsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">131072</span><span class="token plain">,namlen</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">255</span><span class="token plain">,hard,proto</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp,port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,timeo</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><span class="token plain">,retrans</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">,sec</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sys,clientaddr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.100,local_lock</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.101</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>说明已经挂载成功了</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="客户端自动挂载">客户端自动挂载<a class="hash-link" href="#客户端自动挂载" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/fstab</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在结尾添加类似如下配置</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /etc/fstab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Created by anaconda on Thu May 25 13:11:52 2017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/mapper/cl-root     /                       xfs     defaults        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">UUID</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">414ee961-c1cb-4715-b321-241dbe2e9a32 /boot                   xfs     defaults        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/mapper/cl-home     /home                   xfs     defaults        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/mapper/cl-swap     swap                    swap    defaults        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.110:/data     /data                   nfs     defaults        </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>重新加载 <code>systemctl</code></p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="CentOS" term="CentOS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[了解一致性哈希]]></title>
        <id>consistent-hash</id>
        <link href="https://ga0x.com/blog/consistent-hash"/>
        <updated>2020-07-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[了解一致性HASH之前我们先来了解下取模算法]]></summary>
        <content type="html"><![CDATA[<p>了解一致性HASH之前我们先来了解下取模算法</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="举个例子">举个例子<a class="hash-link" href="#举个例子" title="Direct link to heading">​</a></h2><p>我们通常用到的Redis缓存，如果数据量较少一台Redis就搞定了。但是数据量大了，或者为了高可用可能就需要多台了。如果我们现在有4台Redis那么我们怎么能让数据尽量存储平均呢？</p><p>最简单的办法就是：
<strong>Hash(key) % N</strong>，key是要存储的数据，N是Redis的数量，在这里N=4。</p><p><img loading="lazy" alt="Alt text here" src="data:image/jpeg;base64,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" width="913" height="334"></p><p>上面的方法看起来比较美好，但是一旦扩容就会遇到问题。假设说我们现在4台Redis不够用了要加一台那么我们的算法就变成了<strong>Hash(key) % 5</strong>；导致大部分key都会找不到。如果当前并发量比较大就会发生我们常说的<strong>缓存雪崩</strong>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="一致性hash算法">一致性HASH算法<a class="hash-link" href="#一致性hash算法" title="Direct link to heading">​</a></h2><p>一致性HASH算法可以很好的解决我们上面出现问题，原理也是用取模的方法，不过一致性HASH算法是对<strong>2^32</strong>取模，简单来说一致性HASH是将哈希值形成一个圆环，范围是 0 - 2^32；整个HASH环如下</p><p><img loading="lazy" src="data:image/jpeg;base64,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tHbGO/m6rDja2VHXPpQAQeaMT80mcI2lRi64Kh8rl8+2cGK9xrs6wS169+dDJ/Y1A2VYS0q/GcdHI/6K9A6mxqC9TPwnHShcW5UQYY2EwsX4VEyT+OnMw0n2ipnrie3Q8c89VclR20rKBLq2Fi7wUOhjrECEml5bcNBmJLv06cF3go45wUJgRsABCTTDIdm5U/ol6MR6FGTFC5D3bVN4uCsARsuQFWZT1vUGg+jVuB7ULoqfHNJ5FX4F7VC0Hq1Ny+1YINsQ5Cux9q/uVf0PgAXc+Su0fWjEA/5L/9oADAMBAAIAAwAAABD77777777777r7rr77777777777777777777777647pr5b7777777777777777777777777+vH777777777777777777777777b3zQMwYr7777777777777777777xKcDzz/8A9fr02++++++++++++++3C/8A/wD/AN999999/qU6+++++++++++ZiA//AP8A/wB99999999vtK+++++++++d/wD/AP8A/wD/AP333333333/AP1A8888+++wf/8A/wD/AP8A/wD3333333333/8Am8888++//wD/AP8A/wD/AP8A/wDfffffffffffaaPvPPvvP/AP8A/wD/AP8A/wD/AH3333333333307Tzz63zz333333333333333333330CV7z7jzz333333333333333333330CD7z6L33333333333333333333330Cz7z4v33333333333333333333330B97z7f33333333333333333333330D/by7f33333333333333333333330D9bypP33333333333333333333330CP7z6733333333333333333333330B77z4Xz3333333333333333333330CX/8A+509999999999999999999999AN//wDrivfffffffffffffffffffffRnP8A/wC+MX99999999999999999999th/wD/AP77qkAAAAAAAAAAAAAAAAAAAA1z333774Lz/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBwS8999++++qx+/wD/AP8A/wD/AP8A/wD/AP8A/wD/AH6L7z33377774BzP/8A/wD/AP8A/wD/AP8A/wCfwGvvvPfffvvvvvPGuJvfdf8A/wD15WEI++++8999+++++88+/sBMh91lELM9+++++8999+++++88898+i+++8+++++++++8999//xAAeEQEAAgICAwEAAAAAAAAAAAABEUAAMBAgITFQYP/aAAgBAwEBPxD8OfmYvBtTwmSYhZ4TVcOJsi4s7Rw2miH44K4LFcZ7Ka689Vs+l0rr26Pu63W6/lwFkdRXHYVx3FUaUphOtojad43oxwmkOEU47gR8n//EAB4RAAMBAAICAwAAAAAAAAAAAAERQAAgMFBgEEFw/9oACAECAQE/EPRyWZWL4fSyylWWXQsoVWIT4cSkXHkLBaLR+Ii0UngKTxE55Cc83KekH0twPrcjzzzzzzz8T//EACsQAQABAQcCBgIDAQAAAAAAAAERACExQVBRYXFAgSAwkaHB8LHREOHxYP/aAAgBAQABPxD/AJCTU8EySrw4fwyBCq5jEASxvTFGYXPFaJIhQsLqu9wFuv8ACKIyg6bV9/ZTUJWgC9aGoClcRzA24mYJWofJQSWglP4RkQtZb6lThvkj8UNlaAOBYr7+ymizU3C+KCECVESyvzm0mYllwVN+vWExmJm84CChUKWYpfeKgFiWlmbwzkhW9GHSPJQ7QHYzABKA1aB+Ho3o7oCmkNR9Gp7zTXVowp4aqtj1Ki1k0pB7NQLxdysY840LxdppLHIhR8kajk8SA3pLDupYetXOGhl9aJJ3pTQLgOPNQbwaVZ3BRQ3edD817LFpRUiNTIjph0Ma+Txe1DJdVa9ulvb4yrNJqllNWtVidctMGLVle9/BSMp5R6m1hGhfVw3XLn7qLAdWMTsFxzQttBgdutv01T5qFAMPqAsCrAXtXoY2N4qDMHXogEoqGfdoYeTHpU8YU2kPqvNXEF2RQ45Hham7yadG8eBUEKB2+cl71uCl0xxV50KlwC9am5w/0yfAKv0KEXb0G+uxq1ymSDLuvzREgj5yTsGLQ0oAALAsyq30z97TzbXLbI3q8LVatXKxW6pG3Hffy32q1/U2uWxbt9YogkjaeU0FiwnTE0BBAWGXShcej5Wg67LL54iT2xKMrhtPITFmH7ogFwRmE18c8n18ibW4wcuYui57T/fjG4QmixdS75jqRhWtaW+Kwm8KBBmSlgwOHxLe5fHzmfd7u8U7ZHp/3M+CvvZ8+K3q1+MzNsYE0oEx8ChNCjG7b65nMLEipOxHgUc6hBbM0uulngs8dWOAzT7m/g9jXsM0+9v4LfKp+izS63V9/B7xT9BmfN1CJL73gSSGsDRT3ozKRGCa2LHh4nM4SjMrY0XqfEeP8H+5nGwKuI/s8VtuDh/uKnMjoBD58UF3pZzW6pmKkVxTheMvE1hdD2HMZ3gD9qEAMPHBGHoOYjSGHLf8eQF2hFM4n7mXzmipw38vJirvrmGXwZuvwPKuSBTK03LVvRLcGrVrkq1avl2Q3WHbWhEkuyy1pvsWvmNpbUJa09NqMqeKb3ShsoAjzUfa0NTmoN98pjgLlqVMzap1PPUqi3Wu1QGSBYHDJyahZht3GjoWVyPZpRzXOI4ZKeAUKGH7Oeje4zZwo5CI3l5kc47N6YjtOH+3SwrRXCk+ETxkM2KS4VZC9jh06ce+lY00Zac0ASWnWvtSs7OJXdtaO1L1e9VAplxXqI8MuPVmoGsYlWaLu+tACCw6yKIaNYvfVDQIGg/bpxvuY1ajH5PWrKB+cghiG9I5oAVwycL91ZArp0JVkN2lvbBR8cJQsHkq85vFKHarCm9n4H3qXyQUpBJpNQ1PHDWlIB3oHs1R60Cs+2woww0s1iu1b8sHhXJTgjwitBPFEcKk/wDCp/4VHFO9GOtGr6xXtGEf8l//2Q==" width="449" height="468"></p><p>下一步是将我们的服务器进行HASH在环上找到自己的位置（可以是服务器+端口后对2^32取模），假设总共有4台服务，在环上的位置如下：</p><p><img loading="lazy" src="/assets/images/3-b7b97a7c1fc29a6808c6eb0158d4a8bb.jpg" width="714" height="727"></p><p>接下来是如何让数据定位到具体的Node上。</p><p>假设我们有 A ，B ，C ，D四个数据对象经过HASH之后可能是环上的某一个定位但不是Node位置，那么怎么办呢，我们顺时针往下走遇到的第一个Node就是我们要存储的服务器，如下图所示：</p><p><img loading="lazy" src="/assets/images/4-fb31a4af0cb5d2adc584ca37954d8969.jpg" width="704" height="719"></p><p>如果增加或删除服务器只会影响<strong>部分数据</strong></p><p>最后我们总结一致性HASH可以方便的增删服务并且只影响部分数据，注意：是解决了大部分数据问题，而不是所有。算是hash的增强。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="扩展阅读">扩展阅读<a class="hash-link" href="#扩展阅读" title="Direct link to heading">​</a></h2><p>数据量少的情况下我们会遇到数据倾斜，需要加虚拟节点。需要的同学可以自行查询相关资料。</p>]]></content>
        <author>
            <name>xu gao</name>
            <uri>https://github.com/an0nymous</uri>
        </author>
        <category label="Java" term="Java"/>
        <category label="算法" term="算法"/>
    </entry>
</feed>