"use strict";(self.webpackChunkga0x_site=self.webpackChunkga0x_site||[]).push([[8703],{3598:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var i=s(1527),r=s(6120);const t={title:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6",sidebar_label:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6"},d="\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6",l={id:"Linux/test-io",title:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6",description:"1. \u901a\u8fc7 dd \u547d\u4ee4",source:"@site/docs/Linux/test-io.md",sourceDirName:"Linux",slug:"/Linux/test-io",permalink:"/docs/Linux/test-io",draft:!1,unlisted:!1,editUrl:"https://github.com/An0nymous0/ga0x-site/tree/main/docs/Linux/test-io.md",tags:[],version:"current",lastUpdatedAt:1690542572,formattedLastUpdatedAt:"2023\u5e747\u670828\u65e5",frontMatter:{title:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6",sidebar_label:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6"},sidebar:"tutorialSidebar",previous:{title:"IPMICFG\u5e38\u7528\u547d\u4ee4\u53ca\u5b89\u88c5",permalink:"/docs/Linux/IPMICFG-setting"},next:{title:"cert-manager",permalink:"/docs/kubernetes/cert-manager-istio-ingress-gateway"}},o={},c=[{value:"1. \u5b89\u88c5",id:"1-\u5b89\u88c5",level:2},{value:"2.\u7528\u6cd5",id:"2\u7528\u6cd5",level:2},{value:"2.1 \u968f\u673a\u8bfb",id:"21-\u968f\u673a\u8bfb",level:3},{value:"2.2 <strong>\u987a\u5e8f\u8bfb</strong>",id:"22-\u987a\u5e8f\u8bfb",level:3},{value:"2.3 <strong>\u987a\u5e8f\u5199</strong>",id:"23-\u987a\u5e8f\u5199",level:3},{value:"2.3 <strong>\u968f\u673a\u5199</strong>",id:"23-\u968f\u673a\u5199",level:3},{value:"2.3 <strong>\u968f\u673a\u6df7\u5408\u8bfb\u5199</strong>",id:"23-\u968f\u673a\u6df7\u5408\u8bfb\u5199",level:3},{value:"3.\u7ed3\u679c\u5c55\u793a",id:"3\u7ed3\u679c\u5c55\u793a",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"\u5728-linux-\u4e0a\u6d4b\u8bd5\u786c\u76d8io\u8bfb\u5199\u901f\u5ea6",children:"\u5728 Linux \u4e0a\u6d4b\u8bd5\u786c\u76d8IO\u8bfb\u5199\u901f\u5ea6"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u901a\u8fc7 dd \u547d\u4ee4"}),"\n",(0,i.jsx)(n.li,{children:"\u901a\u8fc7\u5b89\u88c5FIO\u6765\u6d4b\u8bd5"}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"dd",children:"dd"}),"\n",(0,i.jsxs)(n.p,{children:["\u8bf7\u52a1\u5fc5\u6ce8\u610f\uff0c\u5f53\u4f7f\u7528 dd \u6d4b\u8bd5\u5199\u5165\u901f\u5ea6\u65f6\uff0c\u786e\u4fdd ",(0,i.jsx)(n.code,{children:"of"})," \u540e\u9762\u7684\u6587\u4ef6\u8def\u5f84\u6307\u5411\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u4ee5\u514d\u9020\u6210\u6570\u636e\u4e22\u5931\uff01"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sync; dd if=/dev/zero of=/tmp/tempfile bs=1M count=1024; sync\n1024+0 records in\n1024+0 records out\n1073741824 bytes (1.1 GB, 1.0 GiB) copied, 2.55331 s, 421 MB/s\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u540c\u6837\u7684\u539f\u7406\u9002\u7528\u4e8e\u6d4b\u8bd5\u5916\u90e8\u5b58\u50a8\u8bbe\u5907\u3002\u5728\u8fdb\u884c\u6d4b\u8bd5\u4e4b\u524d\uff0c\u60a8\u9700\u8981\u786e\u5b9a\u8be5\u8bbe\u5907\u7684\u6302\u8f7d\u70b9\uff0c\u5e76\u4f7f\u7528 dd \u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sync; dd if=/dev/zero of=/media/user/MyUSB/tempfile bs=1M count=1024; sync\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528 dd \u547d\u4ee4\u6d4b\u8bd5\u8bfb\u53d6\u901f\u5ea6\u65f6\uff0c\u8bf7\u6ce8\u610f\u5728 ",(0,i.jsx)(n.code,{children:"if"})," \u540e\u9762\u6307\u5b9a\u4e00\u4e2a\u7531\u5148\u524d\u547d\u4ee4\u751f\u6210\u7684\u6587\u4ef6\u8def\u5f84\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"dd if=/tmp/tempfile of=/dev/null bs=1M count=1024\n1024+0 records in\n1024+0 records out\n1073741824 bytes (1.1 GB, 1.0 GiB) copied, 0.271083 s, 4.0 GB/s\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u6e05\u9664\u7f13\u5b58\u5e76\u51c6\u786e\u6d4b\u8bd5\u771f\u5b9e\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u7ec4\u5408\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo /sbin/sysctl -w vm.drop_caches=3\ndd if=/tmp/tempfile of=/dev/null bs=1M count=1024\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8bf7\u5c06\xa0",(0,i.jsx)(n.code,{children:"/tmp/tempfile"}),"\xa0\u66ff\u6362\u4e3a\u60a8\u8981\u6d4b\u8bd5\u7684\u5916\u90e8\u5b58\u50a8\u8bbe\u5907\u7684\u6b63\u786e\u8def\u5f84\u3002\u4e0a\u8ff0\u547d\u4ee4\u5c06\u6e05\u9664\u7f13\u5b58\u5e76\u4f7f\u7528\xa0",(0,i.jsx)(n.code,{children:"dd"}),"\xa0\u547d\u4ee4\u4ece\u8bbe\u5907\u4e2d\u8bfb\u53d6 1000MB \u7684\u6570\u636e\uff0c\u5e76\u5c06\u8bfb\u53d6\u901f\u5ea6\u663e\u793a\u51fa\u6765\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u60a8\u5f97\u5230\u7684\u662f\u771f\u5b9e\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u800c\u4e0d\u662f\u53d7\u7f13\u5b58\u5f71\u54cd\u7684\u7ed3\u679c\u3002"]}),"\n",(0,i.jsx)(n.h1,{id:"fio",children:"FIO"}),"\n",(0,i.jsx)(n.p,{children:"fio\u662f\u591a\u7ebf\u7a0bIO\u8d1f\u8f7d\u751f\u6210\u6d4b\u8bd5\u5de5\u5177\uff0c\u662f\u6d4b\u8bd5\u670d\u52a1\u5668\u786c\u76d8\u6027\u80fd\u7684\u4f18\u79c0\u5de5\u5177\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"1-\u5b89\u88c5",children:"1. \u5b89\u88c5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/axboe/fio/archive/refs/tags/fio-3.35.tar.gz\nyum install libaio-devel\ntar -zxvf fio-3.35.tar.gz\ncd fio-fio-3.35\nmake\nmake install\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2\u7528\u6cd5",children:"2.\u7528\u6cd5"}),"\n",(0,i.jsx)(n.h3,{id:"21-\u968f\u673a\u8bfb",children:"2.1 \u968f\u673a\u8bfb"}),"\n",(0,i.jsx)(n.p,{children:"\u5411\u78c1\u76d8\u5199\u4e00\u4e2a2G\u6587\u4ef6\uff0c10\u7ebf\u7a0b\uff0c\u968f\u673a\u8bfb1\u5206\u949f\uff0c\u7ed9\u51fa\u7ed3\u679c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"fio -filename=/tmp/test_randread -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53c2\u6570\u8bf4\u660e"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"filename=/dev/sdb1              \u6d4b\u8bd5\u6587\u4ef6\u540d\u79f0\uff0c\u901a\u5e38\u9009\u62e9\u9700\u8981\u6d4b\u8bd5\u7684\u76d8\u7684data\u76ee\u5f55\u3002\ndirect=1                        \u6d4b\u8bd5\u8fc7\u7a0b\u7ed5\u8fc7\u673a\u5668\u81ea\u5e26\u7684buffer\u3002\u4f7f\u6d4b\u8bd5\u7ed3\u679c\u66f4\u771f\u5b9e\u3002\nrw=randwrite                    \u6d4b\u8bd5\u968f\u673a\u5199\u7684I/O\nrw=randrw                       \u6d4b\u8bd5\u968f\u673a\u5199\u548c\u8bfb\u7684I/O\nbs=16k                          \u5355\u6b21io\u7684\u5757\u6587\u4ef6\u5927\u5c0f\u4e3a16k\nbsrange=512-2048                \u540c\u4e0a\uff0c\u63d0\u5b9a\u6570\u636e\u5757\u7684\u5927\u5c0f\u8303\u56f4\nsize=5g                         \u672c\u6b21\u7684\u6d4b\u8bd5\u6587\u4ef6\u5927\u5c0f\u4e3a5g\uff0c\u4ee5\u6bcf\u6b214k\u7684io\u8fdb\u884c\u6d4b\u8bd5\u3002\nnumjobs=30                      \u672c\u6b21\u7684\u6d4b\u8bd5\u7ebf\u7a0b\u4e3a30.\nruntime=1000                    \u6d4b\u8bd5\u65f6\u95f4\u4e3a1000\u79d2\uff0c\u5982\u679c\u4e0d\u5199\u5219\u4e00\u76f4\u5c065g\u6587\u4ef6\u52064k\u6bcf\u6b21\u5199\u5b8c\u4e3a\u6b62\u3002\nioengine=psync                  io\u5f15\u64ce\u4f7f\u7528pync\u65b9\u5f0f\nrwmixwrite=30                   \u5728\u6df7\u5408\u8bfb\u5199\u7684\u6a21\u5f0f\u4e0b\uff0c\u5199\u536030%\ngroup_reporting                 \u5173\u4e8e\u663e\u793a\u7ed3\u679c\u7684\uff0c\u6c47\u603b\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u4fe1\u606f\u3002\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u4ed6\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"lockmem=1g                       \u53ea\u4f7f\u75281g\u5185\u5b58\u8fdb\u884c\u6d4b\u8bd5\u3002\nzero_buffers                     \u75280\u521d\u59cb\u5316\u7cfb\u7edfbuffer\u3002\nnrfiles=8                        \u6bcf\u4e2a\u8fdb\u7a0b\u751f\u6210\u6587\u4ef6\u7684\u6570\u91cf\u3002\nrw=read/write/readwrite          \u987a\u5e8f\u8bfb/\u987a\u5e8f\u5199/\u987a\u5e8f\u6df7\u5408\u8bfb\u5199\nrw=randread/randwrite/wandrw     \u968f\u673a\u8bfb/\u968f\u673a\u5199/\u968f\u673a\u6df7\u5408\u8bfb\u5199\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"22-\u987a\u5e8f\u8bfb",children:["2.2 ",(0,i.jsx)(n.strong,{children:"\u987a\u5e8f\u8bfb"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"fio -filename=/dev/sdb1 -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"23-\u987a\u5e8f\u5199",children:["2.3 ",(0,i.jsx)(n.strong,{children:"\u987a\u5e8f\u5199"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"fio -filename=/dev/sdb1 -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"23-\u968f\u673a\u5199",children:["2.3 ",(0,i.jsx)(n.strong,{children:"\u968f\u673a\u5199"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"fio -filename=/dev/sdb1 -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"23-\u968f\u673a\u6df7\u5408\u8bfb\u5199",children:["2.3 ",(0,i.jsx)(n.strong,{children:"\u968f\u673a\u6df7\u5408\u8bfb\u5199"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"fio -filename=/dev/sdb1 -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest -ioscheduler=noop\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3\u7ed3\u679c\u5c55\u793a",children:"3.\u7ed3\u679c\u5c55\u793a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"mytest: (g=0): rw=randread, bs=(R) 16.0KiB-16.0KiB, (W) 16.0KiB-16.0KiB, (T) 16.0KiB-16.0KiB, ioengine=psync, iodepth=1\n...\nfio-3.35\nStarting 10 threads\nmytest: Laying out IO file (1 file / 2048MiB)\n\nJobs: 10 (f=10): [r(10)][100.0%][r=111MiB/s][r=7113 IOPS][eta 00m:00s]\nmytest: (groupid=0, jobs=10): err= 0: pid=26354: Fri Jul 28 16:37:29 2023\n  read: IOPS=7109, BW=111MiB/s (116MB/s)(6665MiB/60002msec)\n    clat (usec): min=415, max=4161, avg=1401.36, stdev=88.73\n     lat (usec): min=416, max=4162, avg=1401.88, stdev=88.74\n    clat percentiles (usec):\n     |  1.00th=[ 1237],  5.00th=[ 1254], 10.00th=[ 1270], 20.00th=[ 1287],\n     | 30.00th=[ 1319], 40.00th=[ 1434], 50.00th=[ 1450], 60.00th=[ 1450],\n     | 70.00th=[ 1467], 80.00th=[ 1467], 90.00th=[ 1483], 95.00th=[ 1483],\n     | 99.00th=[ 1516], 99.50th=[ 1516], 99.90th=[ 1729], 99.95th=[ 2040],\n     | 99.99th=[ 2769]\n   bw (  KiB/s): min=112416, max=115872, per=100.00%, avg=113805.71, stdev=70.52, samples=1190\n   iops        : min= 7026, max= 7242, avg=7112.86, stdev= 4.41, samples=1190\n  lat (usec)   : 500=0.01%, 750=0.01%, 1000=0.01%\n  lat (msec)   : 2=99.94%, 4=0.05%, 10=0.01%\n  cpu          : usr=0.69%, sys=2.75%, ctx=426771, majf=0, minf=322\n  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%\n     issued rwts: total=426582,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=1\n\nRun status group 0 (all jobs):\n   READ: bw=111MiB/s (116MB/s), 111MiB/s-111MiB/s (116MB/s-116MB/s), io=6665MiB (6989MB), run=60002-60002msec\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"io=\u6267\u884c\u4e86\u591a\u5c11M\u7684IO\n\nbw=\u5e73\u5747IO\u5e26\u5bbd\niops=IOPS \u6bcf\u79d2\u949f\u7684IO\u6570\nrunt=\u7ebf\u7a0b\u8fd0\u884c\u65f6\u95f4\nslat=\u63d0\u4ea4\u5ef6\u8fdf\nclat=\u5b8c\u6210\u5ef6\u8fdf\nlat=\u54cd\u5e94\u65f6\u95f4\nbw=\u5e26\u5bbd\ncpu=\u5229\u7528\u7387\nIO depths=io\u961f\u5217\nIO submit=\u5355\u4e2aIO\u63d0\u4ea4\u8981\u63d0\u4ea4\u7684IO\u6570\nIO complete=Like the above submit number, but for completions instead.\nIO issued=The number of read/write requests issued, and how many of them were short.\nIO latencies=IO\u5b8c\u5ef6\u8fdf\u7684\u5206\u5e03\n\nio=\u603b\u5171\u6267\u884c\u4e86\u591a\u5c11size\u7684IO\naggrb=group\u603b\u5e26\u5bbd\nminb=\u6700\u5c0f.\u5e73\u5747\u5e26\u5bbd.\nmaxb=\u6700\u5927\u5e73\u5747\u5e26\u5bbd.\nmint=group\u4e2d\u7ebf\u7a0b\u7684\u6700\u77ed\u8fd0\u884c\u65f6\u95f4.\nmaxt=group\u4e2d\u7ebf\u7a0b\u7684\u6700\u957f\u8fd0\u884c\u65f6\u95f4.\n\nios=\u6240\u6709group\u603b\u5171\u6267\u884c\u7684IO\u6570.\nmerge=\u603b\u5171\u53d1\u751f\u7684IO\u5408\u5e76\u6570.\nticks=Number of ticks we kept the disk busy.\nio_queue=\u82b1\u8d39\u5728\u961f\u5217\u4e0a\u7684\u603b\u5171\u65f6\u95f4.\nutil=\u78c1\u76d8\u5229\u7528\u7387\nmsec\uff1a \u6beb\u79d2\nusec\uff1a \u5fae\u79d2\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},6120:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>d});var i=s(959);const r={},t=i.createContext(r);function d(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);