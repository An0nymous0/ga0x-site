"use strict";(self.webpackChunkga0x_site=self.webpackChunkga0x_site||[]).push([[34],{599:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>d,toc:()=>t});var r=s(1527),l=s(6120);const c={title:"CentOS9 kubeadm \u5b89\u88c5 K8s(containerd)",sidebar_label:"CentOS9 kubeadm \u5b89\u88c5 K8s(containerd)",tags:["CentOS","Kubeadm","Kubernetes","K8s","containerd","Docker"]},o=void 0,d={id:"kubernetes/kubeadm-install-k8s",title:"CentOS9 kubeadm \u5b89\u88c5 K8s(containerd)",description:"\u5b89\u88c5 docker \u548c containerd \u8fd0\u884c\u65f6",source:"@site/docs/kubernetes/kubeadm-install-k8s.md",sourceDirName:"kubernetes",slug:"/kubernetes/kubeadm-install-k8s",permalink:"/docs/kubernetes/kubeadm-install-k8s",draft:!1,unlisted:!1,editUrl:"https://github.com/An0nymous0/ga0x-site/tree/main/docs/kubernetes/kubeadm-install-k8s.md",tags:[{label:"CentOS",permalink:"/docs/tags/cent-os"},{label:"Kubeadm",permalink:"/docs/tags/kubeadm"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"K8s",permalink:"/docs/tags/k-8-s"},{label:"containerd",permalink:"/docs/tags/containerd"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",lastUpdatedAt:1699522851,formattedLastUpdatedAt:"2023\u5e7411\u67089\u65e5",frontMatter:{title:"CentOS9 kubeadm \u5b89\u88c5 K8s(containerd)",sidebar_label:"CentOS9 kubeadm \u5b89\u88c5 K8s(containerd)",tags:["CentOS","Kubeadm","Kubernetes","K8s","containerd","Docker"]},sidebar:"tutorialSidebar",previous:{title:"cert-manager",permalink:"/docs/kubernetes/cert-manager-istio-ingress-gateway"},next:{title:"kubernetes \u5728\u672c\u5730\u5f00\u53d1\u548c\u8c03\u8bd5\u670d\u52a1",permalink:"/docs/kubernetes/local-debugging"}},i={},t=[{value:"\u5b89\u88c5 docker \u548c containerd \u8fd0\u884c\u65f6",id:"\u5b89\u88c5-docker-\u548c-containerd-\u8fd0\u884c\u65f6",level:2},{value:"\u8bbe\u7f6e\u5b58\u50a8\u5e93",id:"\u8bbe\u7f6e\u5b58\u50a8\u5e93",level:3},{value:"\u5b89\u88c5 Docker \u5f15\u64ce\u3001containerd \u548c Docker Compose",id:"\u5b89\u88c5-docker-\u5f15\u64cecontainerd-\u548c-docker-compose",level:3},{value:"\u542f\u52a8 Docker",id:"\u542f\u52a8-docker",level:3},{value:"\u4e3acontainerd\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c",id:"\u4e3acontainerd\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c",level:3},{value:"\u4fee\u6539 /etc/containerd/config.toml \u914d\u7f6e\u6587\u4ef6",id:"\u4fee\u6539-etccontainerdconfigtoml-\u914d\u7f6e\u6587\u4ef6",level:3},{value:"<strong>\u65b0\u5efak8s.gcr.io \u955c\u50cf\u914d\u7f6e</strong>",id:"\u65b0\u5efak8sgcrio-\u955c\u50cf\u914d\u7f6e",level:3},{value:"<strong>\u65b0\u5efadocker.io\u955c\u50cf\u914d\u7f6e</strong>",id:"\u65b0\u5efadockerio\u955c\u50cf\u914d\u7f6e",level:3},{value:"\u8981\u5b8c\u6210\u4e0a\u9762\u7684\u66f4\u6539\u9700\u8981\u91cd\u542fcontainerd",id:"\u8981\u5b8c\u6210\u4e0a\u9762\u7684\u66f4\u6539\u9700\u8981\u91cd\u542fcontainerd",level:3},{value:"\u73af\u5883\u51c6\u5907",id:"\u73af\u5883\u51c6\u5907",level:2},{value:"\u5173\u95ed\u4ea4\u6362\u5206\u533a",id:"\u5173\u95ed\u4ea4\u6362\u5206\u533a",level:3},{value:"\u5c06 SELinux \u8bbe\u7f6e\u4e3a <code>permissive</code> \u6a21\u5f0f",id:"\u5c06-selinux-\u8bbe\u7f6e\u4e3a-permissive-\u6a21\u5f0f",level:3},{value:"\u8f6c\u53d1 IPv4 \u5e76\u8ba9 iptables \u67e5\u770b\u6865\u63a5\u6d41\u91cf",id:"\u8f6c\u53d1-ipv4-\u5e76\u8ba9-iptables-\u67e5\u770b\u6865\u63a5\u6d41\u91cf",level:3},{value:"\u5f00\u542f ipvs",id:"\u5f00\u542f-ipvs",level:3},{value:"\u5b89\u88c5 kubeadm&amp;init",id:"\u5b89\u88c5-kubeadminit",level:2},{value:"\u6dfb\u52a0 Kubernetes \u7684 <code>yum</code> \u4ed3\u5e93",id:"\u6dfb\u52a0-kubernetes-\u7684-yum-\u4ed3\u5e93",level:3},{value:"\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\uff0c\u5e76\u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",id:"\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl\u5e76\u542f\u7528-kubelet-\u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",level:3},{value:"\u8bbe\u7f6e\u4e3b\u673a\u540d",id:"\u8bbe\u7f6e\u4e3b\u673a\u540d",level:3},{value:"\u4fee\u6539 hosts",id:"\u4fee\u6539-hosts",level:3},{value:"\u5bfc\u51fa\u9ed8\u8ba4kubeadm.yaml",id:"\u5bfc\u51fa\u9ed8\u8ba4kubeadmyaml",level:3},{value:"\u90e8\u7f72 pod \u7f51\u7edc",id:"\u90e8\u7f72-pod-\u7f51\u7edc",level:3},{value:"\u5982\u679c\u5148\u60f3\u5355\u8282\u70b9\u8fd0\u884c\u9700\u8981\u53bb\u9664\u6c61\u70b9",id:"\u5982\u679c\u5148\u60f3\u5355\u8282\u70b9\u8fd0\u884c\u9700\u8981\u53bb\u9664\u6c61\u70b9",level:3},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u5b89\u88c5-docker-\u548c-containerd-\u8fd0\u884c\u65f6",children:"\u5b89\u88c5 docker \u548c containerd \u8fd0\u884c\u65f6"}),"\n",(0,r.jsx)(n.h3,{id:"\u8bbe\u7f6e\u5b58\u50a8\u5e93",children:"\u8bbe\u7f6e\u5b58\u50a8\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5-docker-\u5f15\u64cecontainerd-\u548c-docker-compose",children:"\u5b89\u88c5 Docker \u5f15\u64ce\u3001containerd \u548c Docker Compose"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u542f\u52a8-docker",children:"\u542f\u52a8 Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo systemctl start docker\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3acontainerd\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c",children:"\u4e3acontainerd\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo containerd config default | sudo tee /etc/containerd/config.toml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4fee\u6539-etccontainerdconfigtoml-\u914d\u7f6e\u6587\u4ef6",children:"\u4fee\u6539 /etc/containerd/config.toml \u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["\u5c06 ",(0,r.jsx)(n.code,{children:"cgroupdriver"})," \u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"systemd"})]})}),"\n",(0,r.jsxs)(n.p,{children:["\u627e\u5230\n",(0,r.jsx)(n.code,{children:'[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]'}),"\n\u5e76\u5c06 ",(0,r.jsx)(n.code,{children:"SystemdCgroup"})," \u7684\u503c\u66f4\u6539\u4e3a ",(0,r.jsx)(n.code,{children:"true"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4fee\u6539 pause \u955c\u50cf\u5730\u5740"})}),"\n",(0,r.jsxs)(n.p,{children:["\u627e\u5230\n",(0,r.jsx)(n.code,{children:'[plugins."io.containerd.grpc.v1.cri"]'}),"\n\u5e76\u5c06 ",(0,r.jsx)(n.code,{children:"sandbox_image"})," \u7684\u503c\u66f4\u6539\u4e3a ",(0,r.jsx)(n.code,{children:"registry.cn-hangzhou.aliyuncs.com/google\\_containers/pause:3.6"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4fee\u6539 CRI API \u7684\u955c\u50cf\u5730\u5740"})}),"\n",(0,r.jsxs)(n.p,{children:["\u627e\u5230\n",(0,r.jsx)(n.code,{children:'[plugins."io.containerd.grpc.v1.cri".registry]'}),"\n\u5e76\u5c06 ",(0,r.jsx)(n.code,{children:"config_path"})," \u7684\u503c\u66f4\u6539\u4e3a ",(0,r.jsx)(n.code,{children:"/etc/containerd/certs.d"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4fdd\u5b58\u4e0a\u9762\u7684\u66f4\u6539"})}),"\n",(0,r.jsx)(n.h3,{id:"\u65b0\u5efak8sgcrio-\u955c\u50cf\u914d\u7f6e",children:(0,r.jsx)(n.strong,{children:"\u65b0\u5efak8s.gcr.io \u955c\u50cf\u914d\u7f6e"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'mkdir -p /etc/containerd/certs.d/k8s.gcr.io\n\ncat << EOF > /etc/containerd/certs.d/k8s.gcr.io/hosts.toml\nserver = "https://k8s.gcr.io"\n\n[host."https://registry.cn-hangzhou.aliyuncs.com/google_containers"]\ncapabilities = ["pull", "resolve"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u65b0\u5efadockerio\u955c\u50cf\u914d\u7f6e",children:(0,r.jsx)(n.strong,{children:"\u65b0\u5efadocker.io\u955c\u50cf\u914d\u7f6e"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'mkdir -p /etc/containerd/certs.d/docker.io\n\ncat << EOF > /etc/containerd/certs.d/docker.io/hosts.toml\nserver = "https://registry-1.docker.io"\n\n[host."https://\u4f60\u7684\u5730\u5740.mirror.aliyuncs.com"]\n  capabilities = ["pull", "resolve", "push"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u8981\u5b8c\u6210\u4e0a\u9762\u7684\u66f4\u6539\u9700\u8981\u91cd\u542fcontainerd",children:"\u8981\u5b8c\u6210\u4e0a\u9762\u7684\u66f4\u6539\u9700\u8981\u91cd\u542fcontainerd"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo systemctl restart containerd\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u610f \u4e0a\u9762",(0,r.jsx)(n.code,{children:"registry"}),"\u914d\u7f6e\u90e8\u5206\u4e0d\u4f1a\u5f71\u54cd ctr \u548c docker \u547d\u4ee4\u7684\u52a0\u901f\uff0c\u6240\u4ee5 ",(0,r.jsx)(n.code,{children:'"io.containerd.grpc.v1.cri"'})," \u914d\u7f6e\u4e0d\u9002\u7528\u4e8e ctr pull&docker pull\u7b49\u7b49\uff0c\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u4e3a k8s \u52a0\u901f\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528 docker-cli \u548c ctr \u7684\u540c\u5b66\u53ef\u4ee5\u5355\u72ec\u53bb\u914d\u7f6e\u6216\u8005\u76f4\u63a5\u7528",(0,r.jsx)(n.strong,{children:"crictl"}),"\uff0c\u56e0\u4e3a\u6211\u4eec\u6700\u7ec8\u7528\u7684\u662f k8s \u6240\u4ee5\u8fd9\u91cc\u4e0d\u8fc7\u591a\u8bb2\u8ff0\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u73af\u5883\u51c6\u5907",children:"\u73af\u5883\u51c6\u5907"}),"\n",(0,r.jsx)(n.h3,{id:"\u5173\u95ed\u4ea4\u6362\u5206\u533a",children:"\u5173\u95ed\u4ea4\u6362\u5206\u533a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo swapoff \u2013a\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"\u5c06-selinux-\u8bbe\u7f6e\u4e3a-permissive-\u6a21\u5f0f",children:["\u5c06 SELinux \u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"permissive"})," \u6a21\u5f0f"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u5c06 SELinux \u8bbe\u7f6e\u4e3a permissive \u6a21\u5f0f\uff08\u76f8\u5f53\u4e8e\u5c06\u5176\u7981\u7528\uff09\nsudo setenforce 0\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8f6c\u53d1-ipv4-\u5e76\u8ba9-iptables-\u67e5\u770b\u6865\u63a5\u6d41\u91cf",children:"\u8f6c\u53d1 IPv4 \u5e76\u8ba9 iptables \u67e5\u770b\u6865\u63a5\u6d41\u91cf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\n\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# sysctl params required by setup, params persist across reboots\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\nsudo sysctl --system\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5f00\u542f-ipvs",children:"\u5f00\u542f ipvs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mkdir /etc/sysconfig/modules\ncat <<EOF | sudo tee /etc/sysconfig/modules/ipvs.modules\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"tips\uff1a\u9ad8\u7248\u672c\u7684centos\u5185\u6838nf_conntrack_ipv4\u88abnf_conntrack\u66ff\u6362\u4e86\uff0c\u5982\u679c\u4f60\u662f\u4f4e\u7248\u672c\u7684 centos \u8bf7\u628anf_conntrack\u6539\u4e3anf_conntrack_ipv4"}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5-kubeadminit",children:"\u5b89\u88c5 kubeadm&init"}),"\n",(0,r.jsxs)(n.h3,{id:"\u6dfb\u52a0-kubernetes-\u7684-yum-\u4ed3\u5e93",children:["\u6dfb\u52a0 Kubernetes \u7684 ",(0,r.jsx)(n.code,{children:"yum"})," \u4ed3\u5e93"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6 /etc/yum.repos.d/kubernetes.repo \u4e2d\u73b0\u5b58\u7684\u6240\u6709\u914d\u7f6e\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl cri-tools kubernetes-cni\nEOF\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl\u5e76\u542f\u7528-kubelet-\u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8",children:"\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\uff0c\u5e76\u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\nsudo systemctl enable --now kubelet\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8bbe\u7f6e\u4e3b\u673a\u540d",children:"\u8bbe\u7f6e\u4e3b\u673a\u540d"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'sudo hostnamectl set-hostname "master-node-1"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4fee\u6539-hosts",children:"\u4fee\u6539 hosts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo cat <> /etc/hosts\n1.1.1.101 master-node-1\nEOF\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5bfc\u51fa\u9ed8\u8ba4kubeadmyaml",children:"\u5bfc\u51fa\u9ed8\u8ba4kubeadm.yaml"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubeadm config print init-defaults > kubeadm.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'vi kubeadm.yaml\n\n#\u5c3e\u90e8\u6dfb\u52a0\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs\n---\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io/v1beta1\ncgroupDriver: systemd\n\n#\u4fee\u6539advertiseAddress\u5730\u5740\u4e3a\u672c\u673a ip\nlocalAPIEndpoint:\n  advertiseAddress: 1.1.1.101\n  bindPort: 6443\n\n#\u5c06imageRepository: k8s.gcr.io \u4fee\u6539\u4e3a\nimageRepository: registry.aliyuncs.com/google_containers\n\n#\u589e\u52a0certSANs ip\uff0c\u5185\u5916\u7f51\u90fd\u52a0\u8fdb\u53bb\uff0c\u5426\u5219\u751f\u6210\u8bc1\u4e66\u65e0\u6cd5\u7528\u5916\u7f51 master ip \u8fde\u63a5\napiServer:\n  certSANs:\n  - "1.1.1.101"\n  - "123.123.123.123"\n  extraArgs:\n    authorization-mode: Node,RBAC\n  timeoutForControlPlane: 4m0s\n# name \u4fee\u6539\u4e3a\u4f60\u7684\u4e3b\u673a\u540d\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  name: master-node-1\n  taints: null\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7d\u955c\u50cf\nkubeadm config images pull --config kubeadm.yaml\n# \u521d\u59cb\u5316\u96c6\u7fa4\nkubeadm init --config kubeadm.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 1.1.1.101:6443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:cecb4c3d2aedec9789cfea83d8d6886af57c04ec8351d051b9bbbcac5475854d\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u590d\u5236\u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5IPVS\u6a21\u5f0f\u6b63\u5728\u8fd0\u884c"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ipvsadm -Ln\n\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.96.0.1:443 rr\n  -> 1.1.1.101:6443               Masq    1      0          0\nTCP  10.96.0.10:53 rr\n  -> 10.244.0.2:53                Masq    1      0          0\n  -> 10.244.2.8:53                Masq    1      0          0\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u673a\u7fa4\u8fd0\u884c\u662f\u5426\u6b63\u5e38"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get node\n\nNAME   STATUS     ROLES           AGE     VERSION\nnode   NotReady   control-plane   6m51s   v1.28.3\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53d1\u73b0 STATUS \u662f NotReady \u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u6709\u90e8\u7f72 pod \u7684\u7f51\u7edc"}),"\n",(0,r.jsx)(n.h3,{id:"\u90e8\u7f72-pod-\u7f51\u7edc",children:"\u90e8\u7f72 pod \u7f51\u7edc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"tips:"}),"\n\u5982\u679c\u60a8\u4f7f\u7528\u81ea\u5b9a\u4e49podCIDR\uff08\u4e0d\u662f10.244.0.0/16\uff09\uff0c\u60a8\u9996\u5148\u9700\u8981\u4e0b\u8f7d\u4e0a\u8ff0\u6e05\u5355\u5e76\u4fee\u6539\u7f51\u7edc\u4ee5\u5339\u914d\u60a8\u7684\u6e05\u5355\u3002\n\u5982\u679c\u53d1\u73b0\u662fflannel\u7684 pod \u542f\u52a8\u5931\u8d25\u53ef\u80fd\u662f\u96c6\u7fa4 cidr \u914d\u7f6e\u95ee\u9898\u3002\n\u4fee\u6539 controller-manager \u914d\u7f6e\uff0c\u52a0\u5165"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"vim /etc/kubernetes/manifests/kube-controller-manager.yaml\n\t- --allocate-node-cidrs=true\n    - --cluster-cidr=10.88.0.0/16\t\t\t# \u5f53\u524d\u96c6\u7fa4\u7684 cluster-cidr\nsystemctl restart kubelet\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7136\u540e\u7b49\u5f85 controller-manager \u542f\u52a8\u540e\u81ea\u52a8\u5206\u53d1\u7ed9\u65b0 node cidr \u5373\u53ef\u89e3\u51b3\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u662f\u591a\u8282\u70b9\u540e\u7eed\u76f4\u63a5 join \u5c31\u53ef\u4ee5\u4e86 \u5982\u679c\u662f master \u8282\u70b9 join \u540e\u9762\u52a0--control-plane-endpoint"}),"\n",(0,r.jsx)(n.h3,{id:"\u5982\u679c\u5148\u60f3\u5355\u8282\u70b9\u8fd0\u884c\u9700\u8981\u53bb\u9664\u6c61\u70b9",children:"\u5982\u679c\u5148\u60f3\u5355\u8282\u70b9\u8fd0\u884c\u9700\u8981\u53bb\u9664\u6c61\u70b9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"#\u67e5\u770b\u6c61\u70b9\u60c5\u51b5\nkubectl describe node master-node-1|grep Taints\nTaints:             node-role.kubernetes.io/control-plane:NoSchedule\n\n#\u53d6\u6d88\u6c61\u70b9\nkubectl taint nodes master-node-1 node-role.kubernetes.io/control-plane:NoSchedule-\n\n#\u751f\u6210\u6c61\u70b9\nkubectl taint nodes master-node-1  node-role.kubernetes.io/control-plane:NoSchedule\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5176\u4ed6",children:"\u5176\u4ed6"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u662f\u963f\u91cc\u4e91\u81ea\u5efa\u7684 k8s \u53ef\u4ee5\u8003\u8651\u4f7f\u7528Terway\u7f51\u7edc\u63d2\u4ef6\uff0c\u597d\u5904\u662f\u53ef\u4ee5\u8ddf\u4f60\u7684 vpc \u7f51\u7edc\u6253\u901a\u5177\u4f53\u770b\u5b98\u7f51\u6587\u6863"})]})}function u(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},6120:(e,n,s)=>{s.d(n,{Z:()=>d,a:()=>o});var r=s(959);const l={},c=r.createContext(l);function o(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);